<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>UI Testing</title>
  <link rel="stylesheet" type="text/css" href="style.css" />
  <link rel="stylesheet" type="text/css" href=" https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" />
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js" ></script>
</head>
<body>
  <div class="customization">
    <div class="customization-input">
      <div class="label">
        <label for="input-title">Source</label>
        <a href="" id="toggle-title">Hide</a> <!-- ‘Show‘ or ‘Hide‘ -->
      </div>
      <input id="input-title" type="text" value="The Ones Who Walk Away From Omelas">
    </div>
    <div class="customization-input">
      <div class="label">
        <label for="input-author">Author</label>
        <a href="" id="toggle-author">Hide</a> <!-- ‘Show‘ or ‘Hide‘ -->
      </div>
      <input id="input-author" type="text" value="Ursula K. Le Guin">
    </div>
    <div class="actions">
      <div class="save-item" id="copy" onclick="copyImage()">
        <!-- <button class="copy-icon">Copy</button> -->
        <p class="icon"><i class="fa fas fa-copy"></i></p>
        <p class="label" id="copyButton">Copy Image</p>
      </div>
      <div class="save-item" id="download" onclick="capture()">
        <p class="icon"><i class="fa fas fa-download"></i></p>
        <p class="label" id="downloadButton">Save Image</p>
      </div>
    </div>
  </div>
  <div class="quoteshot-container">
    <blockquote id="capture">
      <div class="source">
        <div class="source-meta">
          <p id="title" data-text="title">The Ones Who Walk Away From Omelas</p>
          <p id="author" data-text="author">Ursula K. Le Guin</p>
        </div>
    </div>
    <!-- white-space: break-spaces -->
      <p id="quote" data-text="quote" contenteditable="true" style="white-space: break-spaces;">Each alone, they go west or north, towards the mountains. They go on. They leave Omelas, they walk ahead into the darkness, and they do not come back. The place they go towards is a place even less imaginable to most of us than the city of happiness. I cannot describe it at all. It is possible that it does not exist. But they seem to know where they are going, the ones who walk away from Omelas.</p>
      <p class="quoteshot">Quoteshot.app</p>
    </blockquote>
  </div>

  <!-- save source URL, hidden for share links -->
  <input id="input-url" type="text" value="http://cs.virginia.edu/~robins/YouAndYourResearch.html" style="display:none;">

<script type="text/javascript">
  function capture() {
    const captureElement = document.querySelector('#capture')
    html2canvas(captureElement)
      .then(canvas => {
        canvas.style.display = 'none'
        document.body.appendChild(canvas)
        return canvas
      })
      .then(canvas => {
        const image = canvas.toDataURL('image/png').replace('image/png', 'image/octet-stream')
        const a = document.createElement('a')
        a.setAttribute('download', 'quoteshot-yyyy-mm-dd-hh-ss.png')
        a.setAttribute('href', image)
        a.click()
        canvas.remove()
      })
  }
  const download = document.querySelector('#download')
  download.addEventListener('click', capture)
</script>


<script>
  // copy to clipboard
  var copyIcon = document.querySelector('.copy-icon');
  copyIcon.addEventListener("click", function(e) {
  	e.preventDefault();

  	// get the node
  	var domNode = document.getElementById('capture');
  	domNode.classList.add("on");

  	// get the svg
  	var svg = domNode.querySelector(".line-graph");

  	// copy the canvas to the clipboard with chrome's CliboardItem API
  	// https://developers.google.com/web/updates/2019/07/image-support-for-async-clipboard#images
  	html2canvas(svg).then(function(canvas) {
  		canvas.toBlob(function(blob) {
  			navigator.clipboard
  				.write([
  				new ClipboardItem(
  					Object.defineProperty({}, blob.type, {
  						value: blob,
  						enumerable: true
  					})
  				)
  			])
  				.then(function() {
  				console.log("Copied to clipboard");
  				domNode.classList.remove("on");
  			});
  		});
  	});
  });
</script>

  <div class="share">
    <div class="save-item">
      <button class="copy-icon">Copy to Clipboard</button>
      <div class="share-option" id="download" onclick="capture()">
        <p class="icon">X</p>
        <p class="label" id="btn">Save Image</p>
      </div>
    </div>
  </div>

</body>
<script src="quoteshot.js"></script>

</html>
